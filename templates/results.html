{% extends "base.html" %}

{% block content %}

      <script>
    function checkTaskStatus() {
      // Make an AJAX request to the API endpoint that provides the task status
      fetch('/task/status') // Replace '/task/status' with the actual API endpoint URL
        .then(response => response.json())
        .then(data => {
          // Process the task status data
          console.log(data); // Example: log the task status to the console

          // Check if the task is completed or still in progress
          if (data.status === 'SUCCESS') {
            // Task is completed
            console.log('Task completed!');
            // Perform further actions based on task completion
            // For example, update the UI or display the task result
            document.getElementById('result').innerText = data.result;
          } else if (data.status === 'FAILURE') {
            // Task has failed
            console.log('Task failed!');
            // Perform error handling or display error message
            document.getElementById('result').innerText = 'Task failed!';
          } else {
            // Task is still in progress
            console.log('Task in progress...');
            // Continue checking task status after a delay
            setTimeout(checkTaskStatus, 5000); // Check again after 5 seconds
          }
        })
        .catch(error => {
          console.error('Error occurred while checking task status:', error);
          // Perform error handling or display error message
          document.getElementById('result').innerText = 'Error occurred while checking task status';
        });
    }

    // Call the function to start checking the task status
    checkTaskStatus();
  </script>

<div class="container" style="background-color:#fff;">
  <h3>Response</h3>
  <div id="response-display" class="mb-3" style="white-space: pre-wrap; word-wrap: break-word;">
    {{ response }}
  </div>
  <button id="copy-button" onclick="copyToClipboard()">Copy to Clipboard</button>
  <a href="{{ url_for('index') }}">Back</a>
</div>

  <!-- Form to continue the conversation -->
   <p>Regenerate this response, including these additional requests or adjustments</p>
  <form action="{{ url_for('continue_conversation') }}" method="POST" onsubmit="showSpinner()">
    <div class="form-group">
      <textarea class="form-control" id="additional_input" name="additional_input" rows="3"></textarea>
    </div>
    <input type="hidden" name="chat_request" value="{{ chat_request }}">
    <input type="hidden" name="topic" value="{{ topic }}">
    <input type="hidden" name="model" value="{{ engine }}">
         <!-- Hidden input field to store previous chat request -->
    <button type="submit" class="btn btn-primary">Regenerate</button>
    <div id="loading-spinner" class="spinner-border text-primary" role="status" style="display:none;">
  </form>




<script>
function copyToClipboard() {
  var responseElement = document.getElementById("response-display");
  var textarea = document.createElement("textarea");
  textarea.value = responseElement.textContent;
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand("copy");
  document.body.removeChild(textarea);
  alert("Text copied to clipboard!");
}

// Hide the spinner when the response page is loaded
window.addEventListener('DOMContentLoaded', (event) => {
  var spinner = document.getElementById("loading-spinner");
  if (spinner) {
    spinner.style.display = "none";
  }
});

function showSpinner() {
  // Show the spinner
  document.getElementById("loading-spinner").style.display = "inline-block";
}

function clearForm() {
  // Get the form element
  var form = document.getElementById("chat-form");
  
  // Reset the form
  form.reset();
}

</script>

{% endblock %}

